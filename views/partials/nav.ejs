<style>
  .elegant-navbar {
    background: #fefefe;
    border-bottom: 1px solid #e8e8e8;
    padding: 12px 0;
    transition: all 0.3s ease;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 1000;
    margin: 0;
  }

  .elegant-navbar.scrolled {
    box-shadow: 0 2px 20px rgba(0, 0, 0, 0.08);
    background: rgba(254, 254, 254, 0.95);
    backdrop-filter: blur(10px);
  }

  .navbar-brand-elegant {
    font-family: 'Dancing Script', cursive;
    font-size: 2rem;
    font-weight: 700;
    color: #2c3e50 !important;
    text-decoration: none;
    letter-spacing: -0.5px;
    transition: all 0.3s ease;
  }

  .navbar-brand-elegant:hover {
    color: #3498db !important;
    transform: scale(1.02);
  }

  .search-container-elegant {
    position: relative;
    max-width: 300px;
    margin: 0 auto;
  }

  .search-input-elegant {
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 25px;
    padding: 8px 40px 8px 16px;
    color: #6c757d;
    font-size: 0.9rem;
    width: 100%;
    transition: all 0.3s ease;
  }

  .search-input-elegant:focus {
    outline: none;
    border-color: #3498db;
    background: white;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
  }

  .search-input-elegant::placeholder {
    color: #adb5bd;
    font-style: italic;
  }

  .search-icon-elegant {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #adb5bd;
    font-size: 0.9rem;
    cursor: pointer;
    transition: color 0.3s ease;
  }

  .search-icon-elegant:hover {
    color: #3498db;
  }

  .nav-links-elegant {
    display: flex;
    align-items: center;
    gap: 20px;
    flex-wrap: nowrap;
  }

  .nav-link-elegant {
    color: #6c757d !important;
    font-weight: 500;
    font-size: 0.95rem;
    text-decoration: none;
    padding: 8px 0;
    position: relative;
    transition: all 0.3s ease;
  }

  .nav-link-elegant:hover {
    color: #2c3e50 !important;
  }

  .nav-link-elegant.active {
    color: #2c3e50 !important;
  }

  .nav-link-elegant::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: #3498db;
    transition: width 0.3s ease;
  }

  .nav-link-elegant:hover::after,
  .nav-link-elegant.active::after {
    width: 100%;
  }

  .user-avatar-container {
    position: relative;
    display: flex;
    align-items: center;
    cursor: pointer;
  }

  .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
    object-fit: cover;
  }

  .user-avatar:hover {
    border-color: #3498db;
    transform: scale(1.05);
  }

  .dropdown-arrow {
    margin-left: 6px;
    color: #6c757d;
    font-size: 0.8rem;
    transition: transform 0.3s ease;
  }

  .user-avatar-container:hover .dropdown-arrow {
    transform: rotate(180deg);
  }

  .dropdown-menu-elegant {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    padding: 8px 0;
    margin-top: 8px;
    min-width: 180px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1001;
  }

  .user-avatar-container:hover .dropdown-menu-elegant,
  .user-avatar-container.show .dropdown-menu-elegant {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .dropdown-menu-elegant:hover {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .dropdown-item-elegant {
    display: block;
    padding: 10px 20px;
    color: #6c757d;
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .dropdown-item-elegant:hover {
    background: #f8f9fa;
    color: #2c3e50;
    padding-left: 24px;
  }

  .dropdown-divider-elegant {
    height: 1px;
    background: #e9ecef;
    margin: 8px 0;
  }

  .auth-buttons {
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
  }

  .btn-signin-elegant {
    color: #6c757d;
    font-weight: 500;
    font-size: 0.9rem;
    text-decoration: none;
    padding: 8px 16px;
    border-radius: 6px;
    transition: all 0.3s ease;
  }

  .btn-signin-elegant:hover {
    color: #2c3e50;
    background: #f8f9fa;
  }

  .btn-signup-elegant {
    background: #3498db;
    color: white;
    font-weight: 500;
    font-size: 0.9rem;
    text-decoration: none;
    padding: 8px 20px;
    border-radius: 6px;
    transition: all 0.3s ease;
  }

  .btn-signup-elegant:hover {
    background: #2980b9;
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
  }

  .navbar-toggler-elegant {
    border: none;
    background: none;
    padding: 4px;
    color: #6c757d;
  }

  .navbar-toggler-elegant:focus {
    outline: none;
    box-shadow: none;
  }

  @media (max-width: 991px) {
    .nav-links-elegant {
      flex-direction: column;
      gap: 12px;
      padding: 20px 15px;
      background: white;
      border-radius: 12px;
      margin-top: 10px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      align-items: stretch;
    }

    .search-container-elegant {
      max-width: 100%;
    }

    .auth-buttons {
      flex-direction: column;
      width: 100%;
      gap: 10px;
      align-items: stretch;
    }

    .btn-signin-elegant,
    .btn-signup-elegant {
      text-align: center;
      width: 100%;
      display: block;
    }

    .nav-link-elegant {
      text-align: center;
      padding: 12px 0;
      border-bottom: 1px solid #f8f9fa;
    }

    .nav-link-elegant:last-child {
      border-bottom: none;
    }
  }
</style>

<!-- Add Google Fonts for elegant typography -->
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">

<nav class="navbar navbar-expand-lg elegant-navbar fixed-top">
  <div class="container">
    <!-- Main navbar row -->
    <div class="row w-100 align-items-center">

      <!-- Brand Column -->
      <div class="col-lg-3 col-6">
        <a class="navbar-brand-elegant" href="/">
          BlogSpace
        </a>
      </div>

      <!-- Search Column (Desktop Only) -->
      <div class="col-lg-4 d-none d-lg-block">
        <div class="search-container-elegant">
          <input type="text" class="search-input-elegant" placeholder="Search">
          <i class="fas fa-search search-icon-elegant"></i>
        </div>
      </div>

      <!-- Navigation Links Column (Desktop Only) -->
      <div class="col-lg-3 d-none d-lg-block">
        <div class="nav-links-elegant justify-content-center">
          <a href="/" class="nav-link-elegant active">Home</a>
          <a href="/blog" class="nav-link-elegant">Blogs</a>
          <a href="/blog/addblog" class="nav-link-elegant">Write</a>
          <!-- <a href="/profile" class="nav-link-elegant">Profile</a> -->
          <a href="/about" class="nav-link-elegant">About</a>
        </div>
      </div>

      <!-- User/Auth Column -->
      <div class="col-lg-2 col-6 d-flex justify-content-end">
        <!-- User Avatar (when logged in) -->
        <div class="user-avatar-container d-none" id="userSection">
          <img src="/public/images/default.png" alt="User Avatar" class="user-avatar">
          <i class="fas fa-chevron-down dropdown-arrow"></i>

          <div class="dropdown-menu-elegant">
            <a href="/profile" class="dropdown-item-elegant">
              <i class="fas fa-user me-2"></i>
              My Profile
            </a>
            <a href="/my-blogs" class="dropdown-item-elegant">
              <i class="fas fa-edit me-2"></i>My Blogs
            </a>
            <a href="/dashboard" class="dropdown-item-elegant">
              <i class="fas fa-chart-line me-2"></i>Dashboard
            </a>
            <a href="/analytics" class="dropdown-item-elegant">
              <i class="fas fa-chart-bar me-2"></i>Analytics
            </a>
            <div class="dropdown-divider-elegant"></div>
            <a href="/settings" class="dropdown-item-elegant">
              <i class="fas fa-cog me-2"></i>Settings
            </a>
            <a href="/help" class="dropdown-item-elegant">
              <i class="fas fa-question-circle me-2"></i>Help
            </a>
            <a href="#" onclick="logout(); return false;" class="dropdown-item-elegant">
              <i class="fas fa-sign-out-alt me-2"></i>Logout
            </a>
          </div>
        </div>




</nav>

<!-- Reset browser defaults and fix navbar positioning -->
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html,
  body {
    margin: 0;
    padding: 0;
  }

  body {
    padding-top: 70px;
  }

  .navbar {
    margin: 0 !important;
    padding: 0 !important;
  }
</style>

<script>
  // Scroll effect
  window.addEventListener('scroll', function () {
    const navbar = document.querySelector('.elegant-navbar');
    if (window.scrollY > 50) {
      navbar.classList.add('scrolled');
    } else {
      navbar.classList.remove('scrolled');
    }
  });

  // Active link management
  document.addEventListener('DOMContentLoaded', function () {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('.nav-link-elegant');

    navLinks.forEach(link => {
      link.classList.remove('active');
      const href = link.getAttribute('href');

      if (href === currentPath ||
        (currentPath.startsWith('/blog') && href === '/blog') ||
        (currentPath === '/' && href === '/')) {
        link.classList.add('active');
      }
    });
  });

  // Search functionality
  document.querySelectorAll('.search-input-elegant').forEach(input => {
    input.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        const query = this.value.trim();
        if (query) {
          window.location.href = `/blog?search=${encodeURIComponent(query)}`;
        }
      }
    });
  });

  document.querySelectorAll('.search-icon-elegant').forEach(icon => {
    icon.addEventListener('click', function () {
      const input = this.previousElementSibling;
      const query = input.value.trim();
      if (query) {
        window.location.href = `/blog?search=${encodeURIComponent(query)}`;
      }
    });
  });

  // Helper function to get cookie value
  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    if (parts.length === 2) return parts.pop().split(';').shift();
    return null;
  }

  // User authentication state management
  async function checkAuthState() {
    try {
      // Check if JWT token exists in cookies
      const token = getCookie('token');

      if (token) {
        console.log('Token found, verifying...');
        // Verify token and get user data from API
        const response = await fetch('/api/verify-token', {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include' // Include cookies
        });

        if (response.ok) {
          const data = await response.json();
          console.log('User data received:', data);
          if (data.success && data.user) {
            showUserSection(data.user);
          } else {
            console.log('No user data, showing auth section');
            showAuthSection();
          }
        } else {
          // Token is invalid, show auth buttons
          console.log('Token verification failed, status:', response.status);
          showAuthSection();
        }
      } else {
        // No token, show auth buttons
        console.log('No token found, showing auth section');
        showAuthSection();
      }
    } catch (error) {
      console.error('Auth check failed:', error);
      showAuthSection();
    }
  }

  // Show user section (when logged in)
  function showUserSection(userData = null) {
    const userSection = document.getElementById('userSection');
    const authSection = document.getElementById('authSection');
    const mobileUserSection = document.getElementById('mobileUserSection');
    const mobileAuthSection = document.getElementById('mobileAuthSection');

    // Update user avatar with user's profile image or default
    const userAvatar = document.querySelector('.user-avatar');
    if (userAvatar) {
      if (userData && userData.profileImage) {
        userAvatar.src = userData.profileImage;
        userAvatar.alt = userData.fullname || 'User Avatar';
      } else {
        userAvatar.src = '/public/images/default.png'; // Default from user model
        userAvatar.alt = 'User Avatar';
      }

      // Add error handler for image loading
      userAvatar.onerror = function () {
        console.log('Failed to load profile image:', this.src);
        console.log('Trying fallback image...');
        this.src = 'https://via.placeholder.com/36x36/3498db/ffffff?text=U';
        this.onerror = null; // Prevent infinite loop
      };

      // Log the image source for debugging
      console.log('Setting avatar image to:', userAvatar.src);
    }

    // Show user sections, hide auth sections
    if (userSection) {
      userSection.style.display = 'flex';
      userSection.classList.remove('d-none');
    }
    if (authSection) {
      authSection.style.display = 'none';
      authSection.classList.add('d-none');
    }
    if (mobileUserSection) {
      mobileUserSection.style.display = 'block';
      mobileUserSection.classList.remove('d-none');
    }
    if (mobileAuthSection) {
      mobileAuthSection.style.display = 'none';
      mobileAuthSection.classList.add('d-none');
    }
  }

  // Show auth section (when not logged in)
  function showAuthSection() {
    const userSection = document.getElementById('userSection');
    const authSection = document.getElementById('authSection');
    const mobileUserSection = document.getElementById('mobileUserSection');
    const mobileAuthSection = document.getElementById('mobileAuthSection');

    // Show auth sections, hide user sections
    if (userSection) {
      userSection.style.display = 'none';
      userSection.classList.add('d-none');
    }
    if (authSection) {
      authSection.style.display = 'flex';
      authSection.classList.remove('d-none');
    }
    if (mobileUserSection) {
      mobileUserSection.style.display = 'none';
      mobileUserSection.classList.add('d-none');
    }
    if (mobileAuthSection) {
      mobileAuthSection.style.display = 'flex';
      mobileAuthSection.classList.remove('d-none');
    }
  }

  // Add logout functionality
  function logout() {
    // Clear the token cookie
    document.cookie = 'token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
    // Redirect to home page
    window.location.href = '/';
  }

  // Dropdown functionality
  document.addEventListener('DOMContentLoaded', function () {
    const userAvatarContainer = document.getElementById('userSection');

    if (userAvatarContainer) {
      // Toggle dropdown on click (only on avatar/arrow, not on links)
      userAvatarContainer.addEventListener('click', function (e) {
        // Check if the click is on a link or inside a link
        const clickedLink = e.target.closest('a');
        
        // If clicking on a link, don't prevent default - let it navigate
        if (clickedLink) {
          return; // Allow the link to work normally
        }
        
        // Only prevent default and toggle dropdown for avatar/arrow clicks
        e.preventDefault();
        e.stopPropagation();
        this.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function (e) {
        if (!userAvatarContainer.contains(e.target)) {
          userAvatarContainer.classList.remove('show');
        }
      });
    }
  });

  // Call on page load
  document.addEventListener('DOMContentLoaded', checkAuthState);
</script>